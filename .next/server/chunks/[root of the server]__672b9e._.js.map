{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/prisma/prisma-client.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient()\r\n}\r\n\r\ndeclare const globalThis: {\r\n    prismaGlobal: ReturnType<typeof prismaClientSingleton>;\r\n} & typeof global;\r\n\r\nexport const prisma = globalThis.prismaGlobal ?? prismaClientSingleton()\r\n\r\nif (process.env.NODE_ENV !== 'production') globalThis.prismaGlobal = prisma"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,2GAAA,CAAA,eAAY;AAC3B;AAMO,MAAM,SAAS,WAAW,YAAY,IAAI;AAEjD,wCAA2C,WAAW,YAAY,GAAG"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/src/lib/calc-cart-item-total-amount.ts"],"sourcesContent":["import { Ingredient, ProductItem } from '@prisma/client';\r\n\r\ntype Item = {\r\n  productItem: ProductItem;\r\n  ingredients: Ingredient[];\r\n  quantity: number;\r\n};\r\n\r\nexport const calcCartItemTotalAmount = (item: Item): number => {\r\n  return (\r\n    (item.productItem.price +\r\n      item.ingredients.reduce((acc, ingredient) => acc + ingredient.price, 0)) *\r\n    item.quantity\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;AAQO,MAAM,0BAA0B,CAAC;IACtC,OACE,CAAC,KAAK,WAAW,CAAC,KAAK,GACrB,KAAK,WAAW,CAAC,MAAM,CAAC,CAAC,KAAK,aAAe,MAAM,WAAW,KAAK,EAAE,EAAE,IACzE,KAAK,QAAQ;AAEjB"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/src/app/api/cart/route.ts"],"sourcesContent":["import {NextRequest, NextResponse} from 'next/server';\r\nimport {prisma} from '../../../../prisma/prisma-client';\r\nimport { calcCartItemTotalAmount } from '@/lib/calc-cart-item-total-amount';\r\nimport crypto from \"crypto\";\r\nimport {CreateCartItemValues} from \"@/services/dto/cart\";\r\n\r\n\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n\r\n        const cartToken = req.cookies.get('cartToken')?.value;\r\n\r\n\r\n        if (!cartToken) {\r\n            return NextResponse.json({items: []});\r\n        }\r\n\r\n        const userCart = await prisma.cart.findFirst({\r\n            where: {\r\n                OR: [\r\n                    {\r\n                        tokenId: cartToken,\r\n                    },\r\n                ],\r\n            },\r\n            include: {\r\n                items: {\r\n                    orderBy: {\r\n                        createdAt: 'desc',\r\n                    },\r\n                    include: {\r\n                        productItem: {\r\n                            include: {\r\n                                product: true,\r\n                            },\r\n                        },\r\n                        ingredients: true,\r\n                    },\r\n                },\r\n            },\r\n        });\r\n\r\n        return NextResponse.json(userCart);\r\n    } catch (err) {\r\n        console.log(err);\r\n        return NextResponse.json({message: '[CART_GET] Server error'}, {status: 500});\r\n    }\r\n}\r\nasync function getCartTotalAmount(cartId: number): Promise<number> {\r\n    const userCartAfterUpdate = await prisma.cart.findFirst({\r\n        where: {\r\n            id: cartId,\r\n        },\r\n        include: {\r\n            items: {\r\n                orderBy: {\r\n                    createdAt: 'desc',\r\n                },\r\n                include: {\r\n                    productItem: {\r\n                        include: {\r\n                            product: true,\r\n                        },\r\n                    },\r\n                    ingredients: true,\r\n                },\r\n            },\r\n        },\r\n        orderBy: {\r\n            createdAt: 'desc',\r\n        },\r\n    });\r\n\r\n    const totalAmount = userCartAfterUpdate?.items.reduce(\r\n        (acc, item) => acc + calcCartItemTotalAmount(item),\r\n        0,\r\n    );\r\n\r\n    return totalAmount ?? 0;\r\n}\r\nasync function findOrCreateCart(cartToken: string | undefined) {\r\n    let userCart = await prisma.cart.findFirst({\r\n        where: {\r\n                    tokenId: cartToken,\r\n        },\r\n    });\r\n\r\n    if (!userCart) {\r\n        userCart = await prisma.cart.create({\r\n            data: {\r\n                tokenId: cartToken,\r\n            },\r\n        });\r\n    }\r\n\r\n    return userCart;\r\n}\r\nasync function updateCartTotalAmount(cartId: number, totalAmount: number) {\r\n    const updatedCart = await prisma.cart.update({\r\n        where: {\r\n            id: cartId,\r\n        },\r\n        data: {\r\n            totalAmount,\r\n        },\r\n        include: {\r\n            items: {\r\n                orderBy: {\r\n                    createdAt: 'desc',\r\n                },\r\n                include: {\r\n                    productItem: {\r\n                        include: {\r\n                            product: true,\r\n                        },\r\n                    },\r\n                    ingredients: true,\r\n                },\r\n            },\r\n        },\r\n    });\r\n\r\n    return updatedCart;\r\n}\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        let cartToken = req.cookies.get('cartToken')?.value;\r\n\r\n        const data = (await req.json()) as CreateCartItemValues;\r\n\r\n        if (!cartToken) {\r\n            cartToken = crypto.randomUUID();\r\n        }\r\n\r\n        const userCart = await findOrCreateCart(cartToken);\r\n\r\n        const findCartItem = await prisma.cartItem.findFirst({\r\n            where: {\r\n                cartId: userCart.id,\r\n                productItemId: data.productItemId,\r\n                ingredients: { every: { id: { in: data.ingredientsIds } } },\r\n            },\r\n        });\r\n\r\n        if (findCartItem) {\r\n            const updatedCartItem = await prisma.cartItem.update({\r\n                where: {\r\n                    id: findCartItem.id,\r\n                },\r\n                data: {\r\n                    quantity: findCartItem.quantity + data.quantity,\r\n                },\r\n            });\r\n\r\n            const resp = NextResponse.json(updatedCartItem);\r\n            resp.cookies.set('cartToken', cartToken);\r\n            return resp;\r\n        }\r\n\r\n        await prisma.cartItem.create({\r\n            data: {\r\n                cartId: userCart.id,\r\n                productItemId: data.productItemId,\r\n                quantity: data.quantity,\r\n                type: data.type,\r\n                pizzaSize: data.pizzaSize,\r\n                ingredients: { connect: data.ingredientsIds?.map((id) => ({ id })) },\r\n            },\r\n        });\r\n\r\n        const totalAmount = await getCartTotalAmount(userCart.id);\r\n        const updatedCart = await updateCartTotalAmount(userCart.id, totalAmount);\r\n\r\n        const resp = NextResponse.json(updatedCart);\r\n        resp.cookies.set('cartToken', cartToken);\r\n        return resp;\r\n    } catch (err) {\r\n        console.log(err);\r\n        return NextResponse.json({ message: '[CART_POST] Server error' }, { status: 500 });\r\n    }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}